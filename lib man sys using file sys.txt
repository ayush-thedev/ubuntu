#include <iostream>
#include <fstream>
using namespace std;

class Book {
    int book_id;
    string title, author;
    float price;
    int quantity;

public:
    void getdata() {
        cout << "\nEnter Book ID: ";
        cin >> book_id;
        cin.ignore();
        cout << "Enter Title: ";
        getline(cin, title);
        cout << "Enter Author: ";
        getline(cin, author);
        cout << "Enter Price: ";
        cin >> price;
        cout << "Enter Quantity: ";
        cin >> quantity;
    }

    void showdata() {
        cout << "\nBook ID: " << book_id
             << "\nTitle: " << title
             << "\nAuthor: " << author
             << "\nPrice: " << price
             << "\nQuantity: " << quantity;
        if (quantity == 0)
            cout << "  --> Out of Stock!";
        cout << "\n--------------------------\n";
    }

    int getID() { return book_id; }

    void modify() {
        cout << "\nEnter new Price: ";
        cin >> price;
        cout << "Enter new Quantity: ";
        cin >> quantity;
    }
};

// Add new book
void addBook() {
    Book b;
    ofstream fout("library.dat", ios::binary | ios::app);
    b.getdata();
    fout.write((char*)&b, sizeof(b));
    fout.close();
    cout << "\nBook added successfully!\n";
}

// Display all books
void displayBooks() {
    Book b;
    ifstream fin("library.dat", ios::binary);
    while (fin.read((char*)&b, sizeof(b))) {
        b.showdata();
    }
    fin.close();
}

// Search book by ID
void searchBook() {
    int id, found = 0;
    Book b;
    cout << "\nEnter Book ID to search: ";
    cin >> id;
    ifstream fin("library.dat", ios::binary);
    while (fin.read((char*)&b, sizeof(b))) {
        if (b.getID() == id) {
            cout << "\nBook Found!\n";
            b.showdata();
            found = 1;
        }
    }
    if (!found)
        cout << "\nBook not found!\n";
    fin.close();
}

// Modify book
void modifyBook() {
    fstream file("library.dat", ios::binary | ios::in | ios::out);
    Book b;
    int id, found = 0;
    cout << "\nEnter Book ID to modify: ";
    cin >> id;
    while (file.read((char*)&b, sizeof(b))) {
        if (b.getID() == id) {
            b.modify();
            int pos = -1 * sizeof(b);
            file.seekp(pos, ios::cur);
            file.write((char*)&b, sizeof(b));
            cout << "\nBook updated!\n";
            found = 1;
            break;
        }
    }
    if (!found)
        cout << "\nBook not found!\n";
    file.close();
}

// Delete book
void deleteBook() {
    int id;
    Book b;
    ifstream fin("library.dat", ios::binary);
    ofstream fout("temp.dat", ios::binary);
    cout << "\nEnter Book ID to delete: ";
    cin >> id;
    while (fin.read((char*)&b, sizeof(b))) {
        if (b.getID() != id)
            fout.write((char*)&b, sizeof(b));
    }
    fin.close();
    fout.close();
    remove("library.dat");
    rename("temp.dat", "library.dat");
    cout << "\nBook deleted successfully!\n";
}

int main() {
    int choice;
    do {
        cout << "\n--- Library Management System ---";
        cout << "\n1. Add Book\n2. Display All\n3. Search\n4. Modify\n5. Delete\n6. Exit\nEnter choice: ";
        cin >> choice;

        switch (choice) {
        case 1: addBook(); break;
        case 2: displayBooks(); break;
        case 3: searchBook(); break;
        case 4: modifyBook(); break;
        case 5: deleteBook(); break;
        case 6: cout << "\nExiting..."; break;
        default: cout << "\nInvalid choice!";
        }
    } while (choice != 6);
    return 0;
}
